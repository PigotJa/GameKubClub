<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GameKub V7.4.3 (Safe Load)</title>
    
    <script>
        window.onerror = function(m, u, l) { console.log("Error suppressed to prevent freeze"); return true; };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;900&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script defer src="https://download.agora.io/sdk/release/AgoraRTC_N-4.18.2.js"></script>

    <style>
        :root { --primary: #c026d3; --accent: #22d3ee; }
        body { font-family: 'Kanit', sans-serif; background-color: #020617; color: #fff; background-image: radial-gradient(circle at 0% 0%, rgba(124, 58, 237, 0.15) 0%, transparent 50%), radial-gradient(circle at 100% 100%, rgba(192, 38, 211, 0.15) 0%, transparent 50%); background-attachment: fixed; margin:0; padding:0; overflow:hidden; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; }
        .cyber-input { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); padding: 12px; border-radius: 12px; color: white; outline: none; }
        .neon-btn { background: linear-gradient(45deg, var(--accent), #0ea5e9); box-shadow: 0 0 15px rgba(6, 182, 212, 0.4); color:black; font-weight:bold; }
        .rank-admin { background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000); background-size: 400%; animation: rb 5s linear infinite; font-weight:900; border:1px solid white; }
        @keyframes rb { 0%{background-position:0% 50%} 100%{background-position:400% 50%} }
        .safe-pb { padding-bottom: 150px; }
    </style>
</head>
<body>
    <div id="root">
        <div id="emergency-loader" style="height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center;">
             <h1 style="font-size:32px; font-weight:900; background:linear-gradient(to right, #c026d3, #22d3ee); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">GAMEKUB</h1>
             <p style="color:#64748b; margin-top:10px;">üõ°Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢...</p>
        </div>
    </div>

    <script type="text/babel">
        // --- ‚öôÔ∏è ‡∏•‡πá‡∏≠‡∏Ñ Package Name: com.gamekub.club ---
        const AGORA_APP_ID = "e51f6bdc1ad449ab8c08090ba53c1c9f"; 
        const firebaseConfig = {
            apiKey: "AIzaSyD85oV6Wo9Y0agOJrwomi9KFHiX_KDnccs",
            authDomain: "gamekubclub.firebaseapp.com",
            projectId: "gamekubclub",
            storageBucket: "gamekubclub.firebasestorage.app",
            messagingSenderId: "949050109538",
            appId: "1:949050109538:android:c8c2d7dd647a86bbd1eb3b"
        };

        try { firebase.initializeApp(firebaseConfig); } catch(e) {}
        const auth = firebase.auth();
        const db = firebase.firestore();
        const ADMIN_EMAIL = "pigot488@gmail.com";

        let agoraClient = null;
        let localAudioTrack = null;

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [page, setPage] = React.useState('login');
            const [voiceStatus, setVoiceStatus] = React.useState({ joined: false, roomName: '', micOn: true });

            React.useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => {
                    setUser(u);
                    setPage(u ? 'home' : 'login');
                    // üî• ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÇ‡∏´‡∏•‡∏î‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°
                    const el = document.getElementById('emergency-loader');
                    if(el) el.style.display = 'none';
                });
                return unsub;
            }, []);

            // üéôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡∏Ñ‡πå (AppsGeyser Optimized)
            const handleVoice = async (action, roomName = "") => {
                if (typeof AgoraRTC === 'undefined') return alert("‚ö†Ô∏è SDK ‡πÑ‡∏°‡∏Ñ‡πå‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡πÄ‡∏ô‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà)");
                if (!agoraClient) agoraClient = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });

                if (action === 'join') {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true }).catch(() => null);
                        if (!stream) return alert("üö® ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡∏Ñ‡πå‡πÉ‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏û!");
                        
                        await agoraClient.join(AGORA_APP_ID, roomName, null, user.uid);
                        localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
                        await agoraClient.publish([localAudioTrack]);
                        setVoiceStatus({ joined: true, roomName: roomName, micOn: true });
                        
                        agoraClient.on("user-published", async (u, type) => {
                            await agoraClient.subscribe(u, type);
                            if (type === "audio") u.audioTrack.play();
                        });
                    } catch (e) { alert("Mic Error: " + e.message); }
                } else if (action === 'leave') {
                    if (localAudioTrack) { localAudioTrack.close(); localAudioTrack = null; }
                    await agoraClient.leave();
                    setVoiceStatus({ joined: false, roomName: '', micOn: true });
                }
            };

            if (page === 'login') return (
                <div className="h-screen flex flex-col justify-center items-center p-6 bg-black relative overflow-hidden">
                    <div className="z-10 w-full max-w-sm glass-card p-8 text-center border-t-2 border-purple-500">
                        <h1 className="text-4xl font-black italic mb-2 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">GAMEKUB</h1>
                        <button onClick={() => {
                            const e = prompt("üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:"); const p = prompt("üîë ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:");
                            if(e&&p) auth.signInWithEmailAndPassword(e, p).catch(() => auth.createUserWithEmailAndPassword(e, p));
                        }} className="w-full py-4 rounded-xl neon-btn mt-6">üöÄ START GAME</button>
                    </div>
                </div>
            );

            return (
                <div className="h-screen flex flex-col bg-[#020617] text-white overflow-hidden">
                    <header className="p-4 flex justify-between items-center bg-[#020617]/80 backdrop-blur-md border-b border-white/5">
                        <h1 className="text-2xl font-black italic text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">GAMEKUB</h1>
                        <div onClick={() => setPage('profile')} className="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-500 to-cyan-500 p-[2px] cursor-pointer">
                            <div className="w-full h-full rounded-full bg-black flex items-center justify-center font-bold">{user.email[0].toUpperCase()}</div>
                        </div>
                    </header>

                    {voiceStatus.joined && (
                        <div className="bg-green-600 p-2 flex justify-between items-center px-4 animate-pulse">
                            <span className="text-xs font-bold">üéôÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏∏‡∏¢‡πÉ‡∏ô: {voiceStatus.roomName}</span>
                            <button onClick={() => handleVoice('leave')} className="bg-red-600 px-3 py-1 rounded text-[10px] font-bold">‡∏ß‡∏≤‡∏á‡∏™‡∏≤‡∏¢</button>
                        </div>
                    )}

                    <div className="flex-1 overflow-y-auto safe-pb p-4">
                        {page === 'home' && <div className="text-center mt-20 text-gray-500 font-bold">üì¢ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏ô GOD ADMIN!</div>}
                        {page === 'party' && <PartySection db={db} user={user} handleVoice={handleVoice} currentRoom={voiceStatus.roomName} />}
                        {page === 'profile' && <ProfileSection user={user} />}
                        {page === 'chat' && <div className="text-center mt-20 text-gray-500">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô...</div>}
                    </div>

                    <nav className="fixed bottom-0 w-full bg-[#020617]/95 border-t border-white/10 p-4 flex justify-around items-center">
                        <button onClick={()=>setPage('home')} className={page==='home'?'text-cyan-400':'text-gray-500'}>üè†</button>
                        <button onClick={()=>setPage('party')} className={page==='party'?'text-cyan-400':'text-gray-500'}>üéÆ</button>
                        <button onClick={()=>setPage('chat')} className={page==='chat'?'text-cyan-400':'text-gray-500'}>üí¨</button>
                        <button onClick={()=>setPage('profile')} className={page==='profile'?'text-cyan-400':'text-gray-500'}>üë§</button>
                    </nav>
                </div>
            );
        };

        const PartySection = ({db, user, handleVoice, currentRoom}) => {
            const [parties, setP] = React.useState([]);
            React.useEffect(() => db.collection("parties").orderBy("time", "desc").limit(10).onSnapshot(s => setP(s.docs.map(d => ({id: d.id, ...d.data()})))), []);
            return (
                <div className="space-y-4">
                    <h2 className="text-xl font-black text-cyan-400">üéÆ ‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
                    {parties.map(p => (
                        <div key={p.id} className="glass-card p-4 flex justify-between items-center border-l-4 border-cyan-500">
                            <div><p className="font-bold">{p.roomName}</p><p className="text-[10px] text-gray-500">Host: {p.host}</p></div>
                            {currentRoom === p.agoraChannel ? <span className="text-green-400 text-xs">üîä ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß</span> : 
                            <button onClick={()=>handleVoice('join', p.agoraChannel)} className="bg-cyan-500 text-black px-4 py-1 rounded-lg font-bold text-xs">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>}
                        </div>
                    ))}
                </div>
            );
        };

        const ProfileSection = ({user}) => (
            <div className="text-center space-y-6">
                <div className="w-24 h-24 mx-auto rounded-full bg-gradient-to-r from-purple-500 to-cyan-500 p-1">
                    <div className="w-full h-full rounded-full bg-black flex items-center justify-center text-3xl font-bold">{user.email[0].toUpperCase()}</div>
                </div>
                <div className={`p-4 rounded-xl ${user.email === ADMIN_EMAIL ? 'rank-admin' : 'bg-gray-800'}`}>
                    <p className="text-[10px] font-bold uppercase">Current Rank</p>
                    <h3 className="text-2xl font-black italic">{user.email === ADMIN_EMAIL ? 'ü¶Ñ GOD ADMIN' : 'üå± NEWBIE'}</h3>
                </div>
                <button onClick={()=>auth.signOut()} className="w-full py-4 bg-red-600/20 text-red-500 font-bold rounded-xl border border-red-500/50">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
